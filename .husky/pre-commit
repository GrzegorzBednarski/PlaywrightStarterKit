#!/bin/sh
# === Husky pre-commit hook for lint-staged in (mono)repo ===
# This script runs lint-staged in each defined package directory.
# Add more package paths to the 'packages' array as needed.

# Get the root directory of the repository
ROOT_DIR=$(pwd)

# List of package directories to check (add more as needed)
# For single-repo, keep as ("./")
# For monorepo, e.g. ("packages/app1" "packages/app2")
packages=("./")

for package in "${packages[@]}"; do
  cd "$ROOT_DIR/$package" || exit 1
  echo "[husky][pre-commit] Running lint-staged in: $(pwd)"
  npx lint-staged
  # If lint-staged fails, exit with error to block the commit
  if [ $? -ne 0 ]; then
    echo "[husky][pre-commit] lint-staged failed in $package. Commit aborted."
    exit 1
  fi
  cd "$ROOT_DIR" || exit 1
done

# === End of pre-commit hook ===
